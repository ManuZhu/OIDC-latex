\section{Introduction}
\label{sec:intro}


%第一段：
%SSO的特点
%SSO的现状
%当前主流的SSO协议
To maintain each user's profile and provide individual services, each service provider needs to identify each user, which requires the users to be authenticated at multiple online services repeatedly. 
Single Sign-On (SSO) systems enable users to access multiple services (called relying parties, RP) with the single authentication performed at the Identity Provider (IdP). With SSO system deployed, a user only needs to maintain the credential of the IdP, who offers user's attributes (i.e., identity proof) for each RP to accomplish the user's identification. 
SSO system also brings the convenience to RPs, as the risks in the users' authentication are shifted to the IdP, for example, RPs don't need to consider the leakage of users' credentials. 
Therefore, SSO systems are widely deployed and integrated. 
%实际数据
The survey on the top 100 websites from SimilarWeb~\cite{similarweb} demonstrates that 25 websites excluded those which are not available for browser accessing do not integrate the SSO service.

%第二段：
%SSO 引入新的隐私问题
%IdP知道用户登录哪个RP
%RP之间可以合谋知道同一个用户登录哪些RP
However, SSO systems introduces new privacy issues in authentication which exposes the users' login traces. An adversary has the ability to track users' login trace in multiple ways. It is described more detailedly, 1) the adversary is able to act the IdP who always knows which RP a user has accessed; 2) multiple RPs controlled by the adversary may link the same user who logs in each RPs. The leaking of users' login trace can be easily avoided in traditional authentication systems by using different usernames for multiple services. 

%第三段：
%google and facebook的负面新闻
Currently the SSO systems widely accepted by users, such as Google Identity and Facebook Login are provided by the large enterprise who has already held the significant quantity of users' data. For example, Facebook collects user data, such as where you live, your age, gender, level of education, employment details, language and so on, used for commercial purpose or something possibly even worse, such as political purpose. It is reported in 2016 the company Cambridge Analytica utilized the 50 million people's profiles leaked by Facebook to build the portrait of voters, in order to target them with personalised political advertisements~\cite{facebooknews}. Google and Facebook seem to become the real Mr. Know It All, as they know who you are, where you live, what you interest in and so on, as long as you have to use the service provided by them. However, what is even worse is that they apparently are interested in what you have done in other applications without of their control. For example, Google would like to offer \$20 gift card for those people who are willing to accept the Screenwise Meter~\cite{googlenews} (mobile app and web extension) which allows Google to see what you are doing in other applications. However, with Google Identity service (Google's SSO system), it has the ability to surveil what applications people accessed even without any additional payment, which is to be used to draw their portraits. Similarly, the controller of multiple services has the ability to link the users using these services which respectively hold partial users' sensitive profiles to build the users' portraits. 

%As suggested in NIST SP800-63C~\cite{NIST2017draft}, to protect users' privacy, in SSO systems, 1) the user should be able to control the range of the attributes exposed to the RP, 2) multiple RPs should fail to link the user through collusion, 3) IdP should fail to obtain the trace of RPs accessed by a user. The first property is satisfied in most SSO systems. For example, in OAuth and OIDC, IdP exhibits the  attributes requested by the RP and sends the attributes to the RP only when the user has provided a clear consent, which may also minimize the exposed attributes as the user may disagree to provide partial attributes. 


%However, exposing accessed RP to IdP is required for security consideration in existing SSO systems~\cite{ChenPCTKT14}. Firstly, the identity proof should only be sent to the correct RP, which prevents the adversary from performing the impersonation attack with the leaked identity proof. Secondly, the identity proof should be bound with a specific RP and user, which ensures the identity proof is only valid in the certain RP, and avoids the misuse of identity proof, for example, the adversary fails to  use the identity proof for a corrupted RP to  access another RP on behalf of the victim user.

%在SAML SSO profile中，没有严格定义IdP对RP请求的响应中的用户identifier的格式
%在另外一个 Subject Identifier Attributes Profile文档中，声明：可以使用globally-unique的subject（user）identifier，也可以使用 pairwise identifier
Several schemes are proposed to protect users' privacy. To avoid users from being linked by multiple RPs, it requires that the user's identifier in one RP should never be the same with or derivable from the ones of other RPs to prevent a possible correlation among users from multiple RPs. For example, in OIDC and SAML a Pairwise Pseudonymous Identifier (PPID) or named Pairwise Subject Identifier is suggested to be generated by the IdP for the user in each RP~\cite{OpenIDConnect, SAMLIdentifier}.
It is not defined by neither OIDC nor SAML how to generate the distinct user identifier. For example, in MITREid Connect, the open OIDC implementation, PPID is generated by the \verb+Java.Util.UUID+ provided since JAVA 1.5 and specifically bound with corresponding RP identifier. 
%没有规定怎么生成，主流的开源如何生成

Additionally, to avoid users from being tracked by IdP, two SSO systems (BrowserID~\cite{persona} and SPRESSO~\cite{SPRESSO}) are proposed to hide the user's accessed RPs from IdP who fails to obtain the information of accessed RP. In BrowserID, the identity proof is signed with the private key generated by user while the corresponding  public key is bound with users' email by IdP who need not obtain the information of accessed RP. In SPRESSO, RP uses the encrypted RP domain and a nonce as the identifier, so that the real identity of RP is never exposed to IdP. 

However, 
%although the designs of SSO system make the effort to protect users' privacy, 
there is no existing SSO system protecting users' privacy comprehensively. Currently proposed designs for privacy protection are only available in dealing with one privacy leaking problem, none of these systems are able to deal with the both privacy issues at the same time. Therefore, it means that the adversary always have at least one way to track users. 


Widely deployed SSO systems (e.g. OIDC) are unable to hide RPs' identity from IdP for security considerations. Firstly, the identity proof should only be sent to the correct RP, which prevents the adversary from performing the impersonation attack with the leaked identity proof. Secondly, the identity proof should be bound with a specific RP and user, which ensures the identity proof is only valid in the certain RP, and avoids the misuse of identity proof, for example, the adversary fails to  use the identity proof for a corrupted RP to access another RP on behalf of the victim user. However, although BrowserID and SPRESSO achieve the goal of hiding RP from IdP, distinct user identifiers are not available in these systems. As distinct user identifier has to be bound with specific RP, to decide which user identifier is to be used for specific authentication, IdP has to know which RP the request is from. Therefore, in order to provide the same identity to the RP in the multiple logins of a user, both BrowserID and SPRESSO use the email address as the identity, which makes the user linkage (from multiple RPs) possible.


In this paper, we propose the first scheme which deals with all the privacy issues introduced by SSO comprehensively. Recluse enables the RP to hide its identity from IdP for users authentication, as well as IdP is able to provide distinct user identifiers for each RP. To achieve the above goals, we  proposed the scheme for RP and user identifier generating, which allows that, 1) RP has the ability to offer the changing RP identifiers to IdP in each authentication, from which the real RP identity is not possible to be derived without the trapdoor; 2) IdP is able to generate unique user identifier (\verb+user_idp_id+) bound with specific RP identifier, from which the user identifier in RP(\verb+user_rp_id+)is to be derived with the trapdoor. However, multiple RPs are unable to link the user by \verb+user_rp_id+ or \verb+user_idp_id+.

Moreover, Recluse is implemented based on OIDC with the support of Dynamic Registration~\cite{DynamicRegistration}. For OIDC system the Reluse only requires: (1) a new set of public parameters and web interfaces are provided additionally; (2) the new RP identifier and PPID generating algorithm is supported.
Compared with BrowserID and SPRESSO, Recluse does not only deal with the privacy issues comprehensively but also be compatible with traditional OIDC system, which is not achieved by neither BrowserID and SPRESSO. BrowserID requires that the user's identity proof should be generated by user's browser, as well as SPRESSO has to introduce new trustful party into the system.

To deal with the security considerations introduced by hiding RP in OIDC: 1) the identity proof should only be sent to the correct RP; 2) identity proof should not be misused. The following requirements should be fulfilled by Recluse:
\begin{itemize}
\item A new algorithm is proposed to negotiate the RP's identifier between the user and RP for each login. Therefore, the RP's identifier in multiple authentications are different, and IdP fails to infer RP's information or link it in different authentications. Moreover, neither RP nor the user may control the generated identifier, which avoids the misuse of the identity proof. The detailed analysis is provided in Section~\ref{sec:analysis}.
%302跳转可以不产生referer
\item A browser extension is introduced to transmit the messages (i.e.,  request and response) related with the authentication, which ensures only the correct RP receives the id token.
\item A new generation algorithm of PPID is provided, which makes the PPIDs for one user in one RP  indistinguishable  from others (e.g., different users in different RPs), while only the RP (and the user) has the trapdoor to derive the unique identifier from different PPIDs for one user in one RP.
\end{itemize}
We build the prototype system by running the Recluse IdP on the modified MITREid Connect, RP on the SpringMVC frame work and extension on chrome browser. Finally we prove the availability of the Recluse and evaluate the delay introduced by Recluse.


%In this paper, we propose an extension (named PriOIDC) of existing widely adopted SSO system (i.e., OIDC), which preserves the systematically and thoroughly analyzed security, and achieves the fully privacy. That is, (1) the security design in OIDC is inherited to prevent the impersonation attack and  identity injection attack, (2) the privacy enhance mechanisms (e.g., the clear consent from the user and the PPID) are retained, (3) a new mechanism is introduced to hide the user's accessed RP from IdP. Unlike designing and deploying a new SSO systems, we only need to analyze the compliance of the new function (i.e., hiding the user's accessed RP) and the influence to the security introduced by the new mechanism. And, the deployment of PriOIDC only requires: (1) IdP provides a set of public parameters and generates the PPID with a newly provided algorithm, (2) RP integrates the SSO service with a new version software development kit (SDK) whose interface remains unchanged, (3) the user installs an extension to access RP with full privacy anywhere as no persistent storage is required in the user side.



%Moreover, the basic requirement of SSO systems is the security, which includes two aspects: 1) the attacker should not be able to access the honest RP with the honest users' identity; 2) the identity injection will never succeed, that is, the attacker should not be able to make the honest user access the RP with an incorrect identity. Plenty of works are proposed for the security of SSO systems. 
%Firstly, various standards, e.g., OAuth 2.0~\cite{rfc6749}, SAML~\cite{SAML} and OpenID Connect (OIDC)~\cite{OpenIDConnect}, are proposed to formalize the handling at each entity (i.e.,  the user, RP and IdP)  and the information exchanges between the entities. 
%Secondly, the standards, SAML, OAuth and OIDC, are formally analyzed, for example, a general Dolev-Yao style web model is proposed for the web infrastructure~\cite{webmodel} and adopted to analyze the security of OAuth and OIDC~\cite{FettKS16}~\cite{FettKS17}.
%Moreover, the typical implementations of SSO systems, e.g. Google, Facebook, Twitter and the corresponding RPs, are systematically analyzed~\cite{WangCW12}~\cite{FettKS16}~\cite{ZhouE14}~\cite{WangZLG16}, which makes  the security of SSO systems improved significantly.








%整理逻辑

%第三段
%现有研究
%现有研究的缺点
%能否提供统一的隐私要求

%匿名SSO打算放到related work中



%Two SSO systems (BrowserID~\cite{persona} and SPRESSO~\cite{SPRESSO}) are proposed to hide the user's accessed RPs from IdP, while ensuring the security of SSO systems simultaneously. In BrowserID, the user is responsible for sending the identity proof correctly and binding the proof with the correct RP using a newly generated private key, while the corresponding public key is bound with the email address by the IdP who fails to obtain the information of accessed RP. In SPRESSO, the identity proof is bound with an encryption of the RP's domain name by the IdP who knows the user's identity but not the plaintext of the RP's information, and sent to the exact RP by a newly introduced trusted entity (called FWD) who obtains the RP's domain name but not the identity of the user. 

%In BrowserID, the identity proof sent by the user to the RP directly, contains two parts: one is generated by the IdP which binds the user's email address with a public key, and the other is a signature of the RP generated by the user with the corresponding private key. Therefore, IdP in BrowserID fails to obtain the information of RP. In SPRESSO, RP encrypts its domain name (and a random nonce) with a symmetric key as the identifier  to obtain the identity proof, which makes others fail to infer the RP from the identifier, and a new entity (FWD) is introduced to relay the identity proof from the IdP to the RP. Therefore, for one identity proof in SPRESSO, IdP only knows the user's identity  while the FWD only knows the RP.



%However, BrowserID and SPRESSO are both redesigns of SSO systems, and therefore incompatible with existing widely deployed SSO systems (e.g., OAuth, OIDC and SAML). Moreover, the new SSO systems require a  complicated, formal and thorough security analysis of both the designs and various implementations. As shown in ~\cite{BrowserID}, vulnerabilities have been found in the implementation of BrowserID. More importantly,  in order to provide the same identity to the RP in the multiple logins of a user, both BrowserID and SPRESSO use the email address as the identity, which makes the user linkage (from multiple RPs) possible.

%Vairous SSO protocols are proposed to hide the users' accessing to RPs from the IdP. In the BrowserID system~\cite{persona}, a user firstly generates a asymmetric key pair. The IdP authenticates the user and offers a user certificate (UC) which contains the user's email address with the user's public key. User is to sign the origin of the RP with the corresponding private key as the identity assertion (IA). RP is able to identify the user by UC and IA. 
%the user sends RP the user certificate (i.e. combing the user's email address with the user's public key) and identity assertion (i.e., the origin of the RP signed by the user with the corresponding private key) to complete the authentication, and is formally analyzed and found severe attacks~\cite{BrowserID}.
%SPRESSO~\cite{SPRESSO} is designed based on the standard HTML5 and web features, and formally analyzed based on the expressive Dolev-Yao style model of the web infrastructure~\cite{webmodel}. But for RPs to identify a user, both BrowserID and SPRESSO need to provide user's real identity (or a constant pseudonym) to each RP. Communication among multiple RPs would allow RPs to profile the user.  
%If a user logs in multiple RPs, these RPs are able to draw his/her trace. 


%Therefore there are no SSO protocols so far that protect users from tracking by both IdP and RPs simultaneously. NIST publication has issued that proxy is able to protect users' privacy in SSO system. It is defined that when the proxy can keep IdP and RP anonymous to each other and itself the proxy is called the triple blind proxy. But no existing proxy has achieved this goal. 
%that the triple blind proxy can protect users from being tracked, but there is no existing systems achieved this goal. 
%Moreover, the protocols protecting user's privacy (such as, SPRESSO and BrowserID) are quite distinct from the widely adopted protocols. There is to be a huge cost if IdP developers migrate their systems into a totally brand-new architecture.
%第四段
%IdP钓鱼网站问题
%转移到安全分析
%Besides tracking user, IdP in traditional SSO system is not expected to protect users from phishing attack either. Imagine that you visit \emph{phishingsite.com} which is established by a malicious opponent and allows user to log in using a Google account. Google SSO allows web application to direct user to Google's login web page and user need log in Google. However, \emph{phishingsite} directs you to a phishing site totally same as Google's web page instead of the real one. That is, while you accomplish the authentication, e.g., inputting your password, your password is to be stolen by malicious opponent. 

%Phishing attack in SSO systems has been considered by OAuth 2.0~\cite{rfc6749} and several papers~\cite{anti_phishing}~\cite{devil_phishing}~\cite{mechanism_phishing} are proposed to discuss it. There is, however, no existing schemes can be adopted to enhance the security of popular protocols, e.g., OpenID Connect. 
 

%In this paper, we propose an extension (named PriOIDC) of existing widely adopted SSO system (i.e., OIDC), which preserves the systematically and thoroughly analyzed security, and achieves the fully privacy. That is, (1) the security design in OIDC is inherited to prevent the impersonation attack and  identity injection attack, (2) the privacy enhance mechanisms (e.g., the clear consent from the user and the PPID) are retained, (3) a new mechanism is introduced to hide the user's accessed RP from IdP. Unlike designing and deploying a new SSO systems, we only need to analyze the compliance of the new function (i.e., hiding the user's accessed RP) and the influence to the security introduced by the new mechanism. And, the deployment of PriOIDC only requires: (1) IdP provides a set of public parameters and generates the PPID with a newly provided algorithm, (2) RP integrates the SSO service with a new version software development kit (SDK) whose interface remains unchanged, (3) the user installs an extension to access RP with full privacy anywhere as no persistent storage is required in the user side.

%第⑤段：
%我们的目标
%建立一套新的单点登录系统，满足：
%1 满足NIST的隐私需求
%2 便于现有系统的迁移
%To hide the user's accessed RP from IdP, PriOIDC avoids the potential leakage in the identity proof (i.e., id token in OIDC)  and the corresponding message transmission. Moreover, PriOIDC enables only the RP (and the user) to derive the user's unique identifier from different PPIDs,  which  allows the RP to provide the individual service with the unique identifier and avoids the user linkage as both the PPID and user's unique identifier in RP are different for various RPs. PriOIDC achieves these as follows: 
%\begin{itemize}
%\item A new algorithm is proposed to negotiate the RP's identifier between the user and RP for each login. Therefore, the RP's identifier in multiple id tokens are different, and IdP fails to infer RP's information in the generation of one or multiple id tokens. Moreover, neither RP nor the user may control the generated identifier, which avoids the misuse of the id token. The detailed analysis is provided  in Section~\ref{sec:analysis}.
%\item A browser extension is introduced to transmit the messages (i.e.,  request and response) related with the id token. IdP fails to infer the RP's information through the network traffic, and the extension ensures only the correct RP receives the id token.
%\item A new generation algorithm of PPID is provided, which makes the PPIDs for one user in one RP  indistinguishable  from others (e.g., different users in different RPs), while only the RP (and the user) has the trapdoor to derive the unique identifier from different PPIDs for one user in one RP.
%\end{itemize}


%第六段
%我们的贡献
%提出协议
%考虑能否根据模型进行分析
%实现原型系统
The main contributions of Recluse are as follows:
\begin{itemize}
\item We propose a new scheme which deals with all the privacy issues introduced by SSO comprehensively. It has the ability to prevent IdP from tracking users' login trace, as well as multiple RPs are unable to link the users either.
%pratical extension for OIDC, which inherits the systematically and thoroughly analyzed  security and privacy mechanisms of OIDC, and achieves the full privacy for users by hiding the accessed RPs from IdP.
\item We developed the prototype of Recluse. The evaluation demonstrates the effectiveness and efficiency of Recluse. We also provide a systematic analysis of Recluse to prove that Recluse introduces no degradation in the security of Recluse.
\end{itemize}



%第七段
%文章结构
The rest of this paper is organized as follows. We introduce the background and the threat model in Sections~\ref{sec:back} and~\ref{sec:overview}. Section~\ref{sec:protocol} describes the design  and details of Recluse. A systematical analysis is presented in Section~\ref{sec:analysis}. We provide the implementation specifics and evaluation in Section~\ref{sec:evaluation}, then introduce the related works in Section~\ref{sec:related}, and draw the conclusion finally. 

%This paper is organized as follows: Section~\ref{sec:back} provides the knowledge of OpenID Connect. Section~\ref{sec:overview} gives the overview of this scheme and its attack surface. Section~\ref{sec:protocol} describes the construction and details of this scheme. Section~\ref{sec:analysis} provides the detailed analysis of the new scheme. Section~\ref{sec:evaluation} offers a performance evaluation of our prototype system. Section~\ref{sec:related} discusses the related works. In Section~\ref{sec:conclusion}, a conclusion is given.



\begin{comment}
%These protocols are classified into two classes according to the objective:
%(1) preventing the RP obtaining the user's identity and (2) avoiding the IdP learning at which RP the user logins in.
Anonymous SSO authentications schemes belonging to the first one and apply to the RPs who do not require the user's identity nor PII, and just  need to check whether the user is authorised or not. These schemes allow users to access a service protected by a verifier without revealing their identities to the RPs.

However, to provide the continuous and preconized service, RP needs to obtain the unique pseudonym for each user.
In this case, the solutions belong to the class 2 is more suitable, as the IdP doesn't know which RP the user access while the RP only knows the user's pseudonym but not the real identity.
Vairous SSO protocols are proposed to hide the users accessed RPs from the IdP. 
In the BrowserID system~\cite{persona}, the user sends RP the user certificate (i.e. combing the user's email address with the user's public key) and identity assertion (i.e., the origin of the RP signed by the user with the corresponding private key) to complete the authentication, and is formally analyzed and found severe attacks~\cite{BrowserID}.
SPRESSO~\cite{SPRESSO} is proposed based on the standard HTML5 and web features, and formally analyzed based on the expressive Dolev-Yao style model of the web infrastructure~\cite{webmodel}.





For security consideration, the ticket issued by the IdP should contain the identity of RP, to send the ticket or ticket index, the IdP should construct the rediect URL which contains the  RP URL.

%大量工作来提升协议的安全性，包括1.协议本身的安全性；2. 具体实现的安全性。
The security of SSO systems is improved by .
The OAuth 2.0 and OpenId-Connect protocol are formally analyzed under the web model.
The implementations have been evaluated and various vulnerabilities are found which
%Authentication is the first line to protect the user information,

%SSO引入了新的隐私问题，目前已有多项工作1. 协议规范要求IdP在向RP传输PII时，需要得到用户明确授权；2.用户在不同RP使用的不同的标识，防止串联 3.匿名SSO，防止RP获取用户信息


%但是SSO引入了一个明显的问题，即IdP将获取用户访问的RP信息，从而能够***


%本文提出了一种匿名方案，通过集成***，实现了。可以描述该工作的难点





A Single Sign-On (SSO) system contains Identity Provider (IdP), Relying Parties (RP) and users. It allows users to log in the IdP once and then user can use RPs' service without extra login. Currently internet services have been an essential part of people's life. To provide their users with personalized services, many web application developers manage to authenticate users. Traditional authentication system requires users to keep individual accounts and passwords.

%SSO引入了新的安全问题 However, SSO introduces new risk to the user's privacy.
Introduce the flaws of current sso system. All the popular sso protocols can't hide the login information , who login in which web application. And even the specification of some protocols advise the IdP should keep the user identity unique in each RP, but may sso service providers haven't confirm the rule, such as Google.

%现有的缓解方法
Introduce what we want about the sso system. When the user logs in a RP with the sso service, the IdP will get nothing can link the user an the RP. And even the multi-RP collusion cannot deduces the user's login trace.

%但是现有解决方法还不够，引入我们的问题
Our contributions:

%我们方法的基本原理

\end{comment}