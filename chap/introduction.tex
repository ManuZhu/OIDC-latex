\section{Introduction}
\label{sec:intro}


%第一段：
%SSO的特点
%SSO的现状

%To maintain each user's profile and provide individual services, each service provider needs to identify each user, which requires the users to be authenticated at multiple online services repeatedly. Single Sign-On (SSO) systems enable users to access multiple services (called relying parties, RP) with the single authentication performed at the Identity Provider (IdP).

Single sign-on (SSO) systems, such as OAuth, OpenID and SAML, have been widely adopted nowadays as a convenient web authentication mechanism. SSO delegates user authentication from websites, so-called relying parties (RPs), to a third party, so-called identity providers (IdPs), so that users can access different services at cooperating sites via a same authentication attempt. Using SSO, a user no long needs to maintain multiple credentials for different RPs, instead, she only maintains the credential for the IdP, which generates identity assertions for her to prove her identity to RPs.
%offers user's attributes (i.e., identity proof) for each RP to accomplish the user's identification.
%SSO system also brings the convenience to RPs, as the risks in the users' authentication are shifted to the IdP, for example, RPs don't need to consider the leakage of users' credentials.
For RPs, SSO shifts the burden of user authentication from them to IdPs and therefore reduces their own security risks and costs. As a result, SSO has been widely integrated with modern web systems.
%实际数据
%The survey on the top 100 websites from SimilarWeb~\cite{similarweb} demonstrates that only 25 websites (excluding the ones not for browser accessing) do not integrate the SSO service.
According to SimilarWeb~\cite{similarweb}, 75 websites among the top-100 websites support SSO services. Meanwhile, many email and social networking providers such as Google, Facebook, Twitter, etc. have been actively serving as social identity providers to support social login.


%第二段：
%SSO 引入新的隐私问题
%IdP知道用户登录哪个RP
%RP之间可以合谋知道同一个用户登录哪些RP
%In addition to the convenience for both the users and RPs, current SSO systems introduce a new privacy leakage risk for the users.
However, the wide adoption of SSO also raises new privacy concerns regarding online user tracking and profiling~\cite{maler2008venn,NIST2017draft}. In a typical SSO authentication session, for example the OpenID Connect (OIDC) authentication flow as shown in Fig.~\ref{fig:OpenID}, when a user attempts to log in to an RP, the authentication request is redirected from the RP to the IdP, which generates an identify proof containing information about the user (e.g., user identifier and other authorized user attributes) and the requesting RP (e.g., RP identifier, URL, etc.). If a common user identifier is issued by the IdP for a same user across different RPs or a user's identifiers can be derived from each other, which is the case in most SSO systems~[add citations], colluding RPs could not only track her online traces but also correlate her attributes across the sites~\cite{maler2008venn}. We refer to this as {\em RP-based identity linkage}. Moreover, when a user leverages the identity issued by one IdP across multiple RPs, the IdP acquires a central role in web authentication, which enables it to collect information about the user's logins at different sites~\cite{maler2008venn}. Since the information of the RP is necessary in the construction of identity proof, any interested IdP can easily discover all the RPs accessed by a user and reconstruct her access traces by the unique user identifier. We refer to this as {\em IdP-based access tracing}. Both RP-based identity linkage and IdP-based access tracing could lead to more severe privacy violations.

%Instead of maintaining the user's information (including identifier) independently in those systems not integrating the SSO service,  the IdP maintains the user's attributes  and identity proof in SSO systems, which allows the IdP or the colluded RPs to infer the access trace of a specified user~\cite{NIST}. In details, the privacy leakage risks include:
%It has already been discussed in the NIST Special Publication 800-63C~\cite{NIST}. In details, the privacy leakage risks include:

%\begin{itemize}
%\item Identity linkage~\cite{SAMLIdentifier,OpenIDConnect,NIST2017draft}, the colluded RPs may link a user if the user's identifiers (generated by the IdP) in these RPs are the same or derivable from the others, and use the attributes maintained in each RP to profile a user.
%\item Access tracing~\cite{NIST2017draft,persona,SPRESSO}, the IdP knows which RP a specified user has accessed, as the construction and transmission of the identity proof provide the IdP the identifiers and URLs of the user's accessed RPs.
%\end{itemize}

%SSO systems introduces new privacy issues in authentication which exposes the users' login traces which can be easily avoided in traditional authentication systems by using different usernames for multiple services. An adversary has the ability to track users' login trace in multiple ways. It is described more detailedly:
%\begin{itemize}
%\item The curious IdP always knows which RP a user has accessed;
%\item The colluding RPs make the user linkage possible.
%\end{itemize}

%第三段：
%google and facebook的负面新闻
%1. service provider（如DNS）知道你访问了，可以带来很多问题。但是还是不同的，DNS里profile需要评估的是two behavior vectors的similarities，而IdP中都不需要，因为IdP能够区分two behavior vectors 是否来自相同节点。

Meanwhile, large IdPs, especially social IdPs like Google and Facebook, are known to be interested in collecting users' online behavioral information for various purposes (e.g., Screenwise Meter~\cite{googlenews}, Onavo~\cite{Onavo}). By simply serving the IdP role, these companies can easily collect a large amount of continuous data to reconstruct users' online traces. %Unlike other privacy risks, such as user session re-identification that requires to compute the similarity between users' DNS queries~\cite{DNS},
Moreover, many IdPs are also service/content providers hosting a variety of web services. Through internal integration, they could obtain rich information from SSO data to profile their clients.

%The privacy leakage allows the widely deployed SSO systems (e.g., Google Identity and Facebook Login) to perform the long-term profile of the users based on the information of accessed RPs. Firstly, Google and Facebook collect the accessed RPs' identifiers without any limit, as the RP's information is necessary in  the construction of identity proof;
%Secondly, it's feasible for Google and Facebook to model the user's behaviours and monitor the specified users, unlike the user session re-identification in DNS queries where the similarities is needed to classify the user's queries~\cite{DNS}, IdP (e.g., Google and Facebook) may classify the multiple access traces based on the maintained user's unique identity.
%which is much easier than the user session re-identification in DNS queries, which needs to classify the user's queries based on similarities, while Google and Facebook may classify the multiple access traces based on the maintained user's unique identity.
%Thirdly, Google and Facebook are curious about users' behaviours in each RP (may be the competitors), for example, Screenwise Meter~\cite{googlenews} and Onavo~\cite{Onavo} are provided to collect all the traffic of the victim.
%Moreover, the users' attributes are analysed for various purposes, for example, 50 million people's profiles were leaked by Facebook and utilized by Cambridge Analytica to build the portrait of voters for personalised political advertisements~\cite{facebooknews}.

%The privacy leakage is even worse in the widely deployed SSO systems (e.g., Google Identity and Facebook Login). Google and Facebook may
%Google and Facebook seem to become the real Mr. Know It All, as they know who you are, where you live, what you have interest in and so on, as long as you use (or even have used) the provided (SSO) service.
%Firstly, the web service provider (e.g., Google, Facebook) aims to collect as many attributes of each user as possible, even at the cost of extra pay. Both Google and Facebook adopt the
% in addition to collecting the user's attributes (e.g., which RP the user accesses) which are necessary for the provided service, Google and Facebook  are willing to pay the users for more information, Google offers the \$20 gift card for installing the Screenwise Meter~\cite{googlenews} to collect the user's behaviours in each RP, while Facebook .

%Firstly, the IdP (e.g., Google and Facebook) maintains various attributes (including address, age, gender, education level and employment details) of the huge number of users, while the protection still needs to be improved, for example, 50 million people's profiles were leaked by Facebook and utilized by Cambridge Analytica to build the portrait of voters for personalised political advertisements~\cite{facebooknews} in 2016. Secondly, the IdP attempts to collect more information about the users. In addition to the access trace,

%Currently the SSO systems widely accepted by users, such as Google Identity and Facebook Login who have already held the significant quantity of users' data. (1) Google and Facebook are interested in wFor example, Facebook collects user data, such as where you live, your age, gender, level of education, employment details, language and so on, used for commercial purpose or something possibly even worse, such as political purpose. It is reported in 2016 the company Cambridge Analytica utilized the 50 million people's profiles leaked by Facebook to build the portrait of voters, in order to target them with personalised political advertisements~\cite{facebooknews}. Google and Facebook seem to become the real Mr. Know It All, as they know who you are, where you live, what you interest in and so on, as long as you have to use the service provided by them. However, what is even worse is that they apparently are interested in what you have done in other applications without of their control. For example, Google would like to offer \$20 gift card for those people who are willing to accept the Screenwise Meter~\cite{googlenews} (mobile app and web extension) which allows Google to see what you are doing in other applications. However, with Google Identity service (Google's SSO system), it has the ability to surveil what applications people accessed even without any additional payment, which is to be used to draw their portraits. Similarly, the controller of multiple services has the ability to link the users using these services which respectively hold partial users' sensitive profiles to build the users' portraits.

%As suggested in NIST SP800-63C~\cite{NIST2017draft}, to protect users' privacy, in SSO systems, 1) the user should be able to control the range of the attributes exposed to the RP, 2) multiple RPs should fail to link the user through collusion, 3) IdP should fail to obtain the trace of RPs accessed by a user. The first property is satisfied in most SSO systems. For example, in OAuth and OIDC, IdP exhibits the  attributes requested by the RP and sends the attributes to the RP only when the user has provided a clear consent, which may also minimize the exposed attributes as the user may disagree to provide partial attributes.

%However, exposing accessed RP to IdP is required for security consideration in existing SSO systems~\cite{ChenPCTKT14}. Firstly, the identity proof should only be sent to the correct RP, which prevents the adversary from performing the impersonation attack with the leaked identity proof. Secondly, the identity proof should be bound with a specific RP and user, which ensures the identity proof is only valid in the certain RP, and avoids the misuse of identity proof, for example, the adversary fails to  use the identity proof for a corrupted RP to  access another RP on behalf of the victim user.

%~\cite{SAMLIdentifier,OpenIDConnect,persona,SPRESSO} are proposed to protect the user's privacy in SSO systems, either achieving the identity unlinkage~\cite{SAMLIdentifier,OpenIDConnect}, or preventing the IdP from tracing the users~\cite{persona,SPRESSO}.

While the privacy problems in SSO have been widely recognized~\cite{maler2008venn,NIST2017draft}, only a few solutions have been proposed in past years to protect user privacy~\cite{persona,SPRESSO}. Among them, Pairwise Pseudonymous Identifier (PPID) is a most straightforward and commonly accepted solution to defend against RP-based identity linkage, which requires the IdP to create different user identifiers for the user when she logs in at different RPs. In this way, even multiple malicious RPs collude with each other across the system, they cannot link the  pairwise pseudonymous identifiers of the user and track which RPs she has visited. As a recommended practice by NIST~\cite{NIST2017draft}, PPID has been specified in many widely adopted SSO standards including OIDC~\cite{OpenIDConnect} and SAML~\cite{SAMLIdentifier}.

%在SAML SSO profile中，没有严格定义IdP对RP请求的响应中的用户identifier的格式
%在另外一个 Subject Identifier Attributes Profile文档中，声明：可以使用globally-unique的subject（user）identifier，也可以使用 pairwise identifier

%To prevent colluding RPs from performing the identity linkage, the straightforward solution is that the user's identifier in one RP should never be the same with or derivable from the ones of other RPs, which is already specified in the widely adopted SSO standards (e.g., OIDC and SAML), called a Pairwise Pseudonymous Identifier (PPID) in OIDC~\cite{OpenIDConnect} and Pairwise Subject Identifier in SAML~\cite{SAMLIdentifier}. This requirement is also widely satisfied in various SSO implementations. For example, in MITREid Connect (an open-source OIDC implementation), PPID is a random sequence generated by the \verb+Java.Util.UUID+ provided by Java and the binding between the PPID and the RP is only maintained by the IdP, which ensures PPIDs for different RPs are independent in the view of any entities except the IdP and the user.
%and no one except the IdP and the corresponding RP may infer the RP from PPID.

%To prevent the colluded RPs from performing the identity linkage, the user's identifier in one RP should never be the same with or derivable from the ones of other RPs. The widely adopted SSO standards (e.g., OIDC and SAML) have specified the requirements for the IdP to generate the user's identifiers in RPs, i.e., a Pairwise Pseudonymous Identifier (PPID) in OIDC~\cite{OpenIDConnect} and Pairwise Subject Identifier in SAML~\cite{SAMLIdentifier}, while the requirement is satisfied in different ways for the implementations of SSO systems. For example, in MITREid Connect, an open-source OIDC implementation, PPID is a random sequence, which is generated by the \verb+Java.Util.UUID+ provided by Java, and bound with the RP.
%PPID is generated by the \verb+Java.Util.UUID+ provided since JAVA 1.5 and specifically bound with corresponding RP identifier.

%Several schemes are proposed to protect users' privacy. To avoid users from being linked by multiple RPs, it requires that the user's identifier in one RP should never be the same with or derivable from the ones of other RPs to prevent a possible correlation among users from multiple RPs. For example, in OIDC and SAML a Pairwise Pseudonymous Identifier (PPID) or named Pairwise Subject Identifier is suggested to be generated by the IdP for the user in each RP~\cite{OpenIDConnect, SAMLIdentifier}. It is not defined by neither OIDC nor SAML how to generate the distinct user identifier. For example, in MITREid Connect, the open OIDC implementation, PPID is generated by the \verb+Java.Util.UUID+ provided since JAVA 1.5 and specifically bound with corresponding RP identifier.

%没有规定怎么生成，主流的开源如何生成

However, PPID-based approaches cannot prevent the IdPs from tracking at which RPs users log in, since pseudonymous identifiers only hide users' identity from the RPs. To authenticate a user, the IdP has to know her identity. To the best of our knowledge, there are only two approaches (i.e., BrowserID~\cite{persona} and SPRESSO~\cite{SPRESSO}) being proposed so far to prevent IdP-based access tracing. Both adopt the idea of hiding RPs' identities from the IdP during the construction and transmission of identity proofs. In particular, BrowserID (and its prototype system known as Mozilla Persona) uses email address as user identifier, and lets the IdP bind the public key generated by the user with her email. The identity proof is signed with the corresponding private key of the user and transmitted to the RP via the user. With the user as the proxy, the IdP does not know RPs' identities throughout the authentication process. In SPRESSO, the RP generates a dynamic pseudonymous identifier by encrypting its domain and a nonce and passes it to the IdP through the user to create the identity proof, which is returned to the RP through a trusted third party, called forwarder, chosen by the RP itself.

%In BrowserID, the identity proof is signed with the private key generated by user, and transmitted to the RP through the user directly,  while the corresponding  public key is bound with users' email by IdP who need not obtain the information of accessed RP. In SPRESSO, RP encrypts its domain and a nonce as the identifier, so that the real identity of RP is never exposed to IdP, while the identity proof is transmitted to the RP through a trusted entity (named FWD) who doesn't know the user's identity.

%To prevent IdP tracing the RPs accessed by the user, two SSO systems (BrowserID~\cite{persona} and SPRESSO~\cite{SPRESSO}) are proposed to hide the user's accessed RPs from IdP who fails to obtain the information of accessed RP. In BrowserID, the identity proof is signed with the private key generated by user while the corresponding  public key is bound with users' email by IdP who need not obtain the information of accessed RP. In SPRESSO, RP uses the encrypted RP domain and a nonce as the identifier, so that the real identity of RP is never exposed to IdP.


%although the designs of SSO system make the effort to protect users' privacy,
%However, there is no existing SSO system which prevents both the access tracing and identity linkage. The implementations of OIDC and SAML prevent the identity linkage, but allow the IdP to obtain the identifiers of accessed RPs, while BrowserID and SPRESSO are designed to avoid the IdP to obtain the access tracing, but the colluded RPs may still link the user as the unique email address is used as the identifier in all RPs.
%However, there is no existing SSO system protecting users' privacy comprehensively. Currently proposed designs for privacy protection are only available in dealing with one privacy leaking problem, none of these systems are able to deal with the both privacy issues at the same time. Therefore, it means that the adversary always have at least one way to track users.

Unfortunately, none of the existing approaches provides sufficient and comprehensive protection for user security and privacy in SSO. For example \cite{BrowserID} reported that BrowserID suffered from a severe privacy attack in which malicious IdPs could check users' login status at any RP. We also find that the security of SPRESSO highly relies on the forwarder and therefore it is vulnerable when the RP is malicious, which can easily recruit a malicious forwarder to assist the impersonation attack (see the discussion in Section~). Moreover, none of the existing SSO systems could address both RP-based identity linkage and IdP-based access tracing privacy problems at the same time. In BrowserID and SPRESSO, colluding RPs could link a user's logins from the common user identifier used in SSO.

%hide the user's trace from both the IdP and colluded RPs, the curious IdP obtains the users' traces in OIDC and SAML~\cite{SAMLIdentifier, OpenIDConnect}, while the colluded RPs link the user with the same email address in BrowserID~\cite{persona} and SPRESSO~\cite{SPRESSO}.

%---- below discussion should go to contributions
\begin{comment}
The fundamental challenges to hide the user's trace from both the IdP and colluded RPs are as follows: %{\color{blue} The fundamental challenge to hide the user's trace from both the IdP and colluded RPs is that there is no currently existing way allows the IdP to generate a pairwise user identifier (e.g., PPID in OIDC) without the knowledge of accessed RP, which also enables the RP to receive the identifier same or derivable from the previous ones for one user. The weaknesses of current SSO systems are as follows: }
\begin{itemize}
\item The IdP who doesn't know the RP's identifying information, should bind the identity proof with the correct RP and  transmit it to the exact RP, avoiding the misuse of identity proof by the malicious RPs.
%The identity proof should be bound with one RP and transmitted only to this RP, avoiding the misuse of identity proof by the malicious RPs. In SAML and OIDC, the binding and  trusted transmit are performed by the IdP, which makes it fail to prevent access tracing.
\item For one user, the IdP who doesn't know the RP's identifying information, should provide the PPIDs that are (1) un-linkable among RPs to avoid the identity linkage and (2) linkable in the destination RP among different logins for RP to provide the continuous service.

%The identity proof should be bound with the user's account at the destination RP, avoiding the misuse of identity proof by the malicious users. Moreover, the PPID in the identity proof  for one user in one RP should be the same or derivable from the previous ones, allowing the RP to provide the continuous service. In BrowserID~\cite{persona} and SPRESSO~\cite{SPRESSO}, without knowing the RP identifier,  IdP adopts the email address  as PPID, which is the same among different RPs and allows the RPs to infer the user's trace through the identity linkage.
%{\color{blue} The identity proof should be bound with specific account in RP where the binding should be verified by RP. The pairwise user identifier is required to be solely bound with the RP, which may expose the RP's identity to the IdP. Therefore, in BrowserID~\cite{persona} and SPRESSO~\cite{SPRESSO}, the unchanged email address is adopted as the identifier, which is the same among different RPs and allows the RPs to infer the user's trace through the identity linkage.}
\end{itemize}

%Widely deployed SSO systems (e.g. OIDC) are unable to hide RPs' identity from IdP for security considerations. Firstly, the identity proof should only be sent to the correct RP, which prevents the adversary from performing the impersonation attack with the leaked identity proof. Secondly, the identity proof should be bound with a specific RP and user, which ensures the identity proof is only valid in the certain RP, and avoids the misuse of identity proof, for example, the adversary fails to  use the identity proof for a corrupted RP to access another RP on behalf of the victim user. However, although BrowserID and SPRESSO achieve the goal of hiding RP from IdP, distinct user identifiers are not available in these systems. As distinct user identifier has to be bound with specific RP, to decide which user identifier is to be used for specific authentication, IdP has to know which RP the request is from. Therefore, in order to provide the same identity to the RP in the multiple logins of a user, both BrowserID and SPRESSO use the email address as the identity, which makes the user linkage (from multiple RPs) possible.


Moreover, BrowserID and SPRESSO are both redesigns of SSO systems, and therefore incompatible with existing widely deployed SSO systems (e.g., OAuth, OIDC and SAML). The new SSO systems require a complicated, formal and thorough security analysis of both the designs and various implementations. As shown in~\cite{BrowserID, browseridfett2014, gilbert2013formal}, vulnerabilities have been found in the implementation of BrowserID.
\end{comment}
%------------- end of comment

In this paper, we present UPRESSO, an Unlinkable and Privacy-REspecting Single Sign-On system,
%RECLUSE, privacy-\(RE\)specting single sign-On system a\(C\)hieving un\(L\)inkable \(USE\)rs' traces
as a comprehensive solution to tackle the privacy problems in SSO. We propose novel identifier generation schemes to dynamically generate private user and RP identifiers, denoted as $PUID$ and $PRPID$, to construct identity proofs for SSO, which satisfy three properties: (1) when a same or differnt user(s) log in at a same RP, random $PRPID$s are generated in different logins so that a curious IdP cannot infer the real identity of the RP or link multiple logins at that RP; (2) when a same user logs in at a same or different RPs, random $PUID$s are generated so that neither a curious IdP nor colluding RPs can link the logins of that user; (3) when a same user logs in at a same RP, the RP can derive a unique user identifier from different PUIDs with a trapdoor so that it can provide a continuous service to the user during different logins.

%from both the IdP and RPs, named {Recluse}. To achieve this, we rely on the user to achieve the trusted transmit and correctness check of identity proof (same as in BrowserID~\cite{persona}), and propose two algorithms to achieve:

%{\color{blue} To achieve this, we propose the novel method to enable the IdP to generates the pairwise user identifier with the RP's one-time identity, which never exposes the RP's real identity. The method is consisted of RP's identifier generation and PPID generation, where two algorithms are proposed to achieve:}

\begin{comment}

\begin{itemize}
\item RP's identifier generation and transformation, which makes the RP's identifier in multiple authentications  different, and IdP fails to infer RP's information or link it in different authentications. Moreover, neither RP nor the user may control the generated identifier, which avoids the misuse of the identity proof. The detailed analysis is provided in Section~\ref{sec:analysis}.
\item PPID generation, which makes the PPIDs for one user in one RP indistinguishable from others (e.g., different users in different RPs), while only the RP (and the user) has the trapdoor to derive the unique identifier from different PPIDs for one user in one RP.
\end{itemize}

\end{comment}

%{\color{blue} Besides, we also propose a way to shift the responsibilities of trusted transmit and correctness check of identity proof from IdP to user. }


%In this paper, we propose the first scheme which deals with all the privacy issues introduced by SSO comprehensively. Recluse enables the RP to hide its identity from IdP for users authentication, as well as IdP is able to provide distinct user identifiers for each RP. To achieve the above goals, we  proposed the scheme for RP and user identifier generating, which allows that, 1) RP has the ability to offer the changing RP identifiers to IdP in each authentication, from which the real RP identity is not possible to be derived without the trapdoor; 2) IdP is able to generate unique user identifier (\verb+user_idp_id+) bound with specific RP identifier, from which the user identifier in RP(\verb+user_rp_id+)is to be derived with the trapdoor. However, multiple RPs are unable to link the user by \verb+user_rp_id+ or \verb+user_idp_id+.

Unlike previous approaches that require non-trivial re-design of the existing SSO systems, Recluse can be implemented over a widely used OIDC system with small modifications with the support of its dynamic registration function~\cite{DynamicRegistration}.

%Reluse only requires the following modification on  OIDC implementations: (1) an additional web service at the IdP for providing a  set of public parameters; (2) the support for generating  the new RP identifier (at the user and RP), PPID (at the IdP) and user's account (at RP). The prototype demonstrates  that Recluse is incompatible with existing OIDC implementations.

%Compared with BrowserID and SPRESSO, Recluse does not only deal with the privacy issues comprehensively but also be compatible with traditional OIDC system, which is not achieved by neither BrowserID and SPRESSO. BrowserID requires that the user's identity proof should be generated by user's browser, as well as SPRESSO has to introduce new trustful party into the system.
%To deal with the security considerations introduced by hiding RP in OIDC: 1) the identity proof should only be sent to the correct RP; 2) identity proof should not be misused. The following requirements should be fulfilled by Recluse:
%\begin{itemize}
%\item A new algorithm is proposed to negotiate the RP's identifier between the user and RP for each login. Therefore, the RP's identifier in multiple authentications are different, and IdP fails to infer RP's information or link it in different authentications. Moreover, neither RP nor the user may control the generated identifier, which avoids the misuse of the identity proof. The detailed analysis is provided in Section~\ref{sec:analysis}.
%302跳转可以不产生referer
%\item A browser extension is introduced to transmit the messages (i.e.,  request and response) related with the authentication, which ensures only the correct RP receives the id token.
%\item A new generation algorithm of PPID is provided, which makes the PPIDs for one user in one RP  indistinguishable  from others (e.g., different users in different RPs), while only the RP (and the user) has the trapdoor to derive the unique identifier from different PPIDs for one user in one RP.
%\end{itemize}
%We implement Recluse prototype as follows: the IdP is based on the MITREid Connect, RP is a Java web service based on the SpringMVC framework and a chrome extension for the functions on the user side. %Finally we prove the availability of the Recluse and evaluate the delay introduced by Recluse.


%In this paper, we propose an extension (named PriOIDC) of existing widely adopted SSO system (i.e., OIDC), which preserves the systematically and thoroughly analyzed security, and achieves the fully privacy. That is, (1) the security design in OIDC is inherited to prevent the impersonation attack and  identity injection attack, (2) the privacy enhance mechanisms (e.g., the clear consent from the user and the PPID) are retained, (3) a new mechanism is introduced to hide the user's accessed RP from IdP. Unlike designing and deploying a new SSO systems, we only need to analyze the compliance of the new function (i.e., hiding the user's accessed RP) and the influence to the security introduced by the new mechanism. And, the deployment of PriOIDC only requires: (1) IdP provides a set of public parameters and generates the PPID with a newly provided algorithm, (2) RP integrates the SSO service with a new version software development kit (SDK) whose interface remains unchanged, (3) the user installs an extension to access RP with full privacy anywhere as no persistent storage is required in the user side.



%Moreover, the basic requirement of SSO systems is the security, which includes two aspects: 1) the attacker should not be able to access the honest RP with the honest users' identity; 2) the identity injection will never succeed, that is, the attacker should not be able to make the honest user access the RP with an incorrect identity. Plenty of works are proposed for the security of SSO systems.
%Firstly, various standards, e.g., OAuth 2.0~\cite{rfc6749}, SAML~\cite{SAML} and OpenID Connect (OIDC)~\cite{OpenIDConnect}, are proposed to formalize the handling at each entity (i.e.,  the user, RP and IdP)  and the information exchanges between the entities.
%Secondly, the standards, SAML, OAuth and OIDC, are formally analyzed, for example, a general Dolev-Yao style web model is proposed for the web infrastructure~\cite{webmodel} and adopted to analyze the security of OAuth and OIDC~\cite{FettKS16}~\cite{FettKS17}.
%Moreover, the typical implementations of SSO systems, e.g. Google, Facebook, Twitter and the corresponding RPs, are systematically analyzed~\cite{WangCW12}~\cite{FettKS16}~\cite{ZhouE14}~\cite{WangZLG16}, which makes  the security of SSO systems improved significantly.








%整理逻辑

%第三段
%现有研究
%现有研究的缺点
%能否提供统一的隐私要求

%匿名SSO打算放到related work中



%Two SSO systems (BrowserID~\cite{persona} and SPRESSO~\cite{SPRESSO}) are proposed to hide the user's accessed RPs from IdP, while ensuring the security of SSO systems simultaneously. In BrowserID, the user is responsible for sending the identity proof correctly and binding the proof with the correct RP using a newly generated private key, while the corresponding public key is bound with the email address by the IdP who fails to obtain the information of accessed RP. In SPRESSO, the identity proof is bound with an encryption of the RP's domain name by the IdP who knows the user's identity but not the plaintext of the RP's information, and sent to the exact RP by a newly introduced trusted entity (called FWD) who obtains the RP's domain name but not the identity of the user.

%In BrowserID, the identity proof sent by the user to the RP directly, contains two parts: one is generated by the IdP which binds the user's email address with a public key, and the other is a signature of the RP generated by the user with the corresponding private key. Therefore, IdP in BrowserID fails to obtain the information of RP. In SPRESSO, RP encrypts its domain name (and a random nonce) with a symmetric key as the identifier  to obtain the identity proof, which makes others fail to infer the RP from the identifier, and a new entity (FWD) is introduced to relay the identity proof from the IdP to the RP. Therefore, for one identity proof in SPRESSO, IdP only knows the user's identity  while the FWD only knows the RP.



%However, BrowserID and SPRESSO are both redesigns of SSO systems, and therefore incompatible with existing widely deployed SSO systems (e.g., OAuth, OIDC and SAML). Moreover, the new SSO systems require a  complicated, formal and thorough security analysis of both the designs and various implementations. As shown in ~\cite{BrowserID}, vulnerabilities have been found in the implementation of BrowserID. More importantly,  in order to provide the same identity to the RP in the multiple logins of a user, both BrowserID and SPRESSO use the email address as the identity, which makes the user linkage (from multiple RPs) possible.

%Vairous SSO protocols are proposed to hide the users' accessing to RPs from the IdP. In the BrowserID system~\cite{persona}, a user firstly generates a asymmetric key pair. The IdP authenticates the user and offers a user certificate (UC) which contains the user's email address with the user's public key. User is to sign the origin of the RP with the corresponding private key as the identity assertion (IA). RP is able to identify the user by UC and IA.
%the user sends RP the user certificate (i.e. combing the user's email address with the user's public key) and identity assertion (i.e., the origin of the RP signed by the user with the corresponding private key) to complete the authentication, and is formally analyzed and found severe attacks~\cite{BrowserID}.
%SPRESSO~\cite{SPRESSO} is designed based on the standard HTML5 and web features, and formally analyzed based on the expressive Dolev-Yao style model of the web infrastructure~\cite{webmodel}. But for RPs to identify a user, both BrowserID and SPRESSO need to provide user's real identity (or a constant pseudonym) to each RP. Communication among multiple RPs would allow RPs to profile the user.
%If a user logs in multiple RPs, these RPs are able to draw his/her trace.


%Therefore there are no SSO protocols so far that protect users from tracking by both IdP and RPs simultaneously. NIST publication has issued that proxy is able to protect users' privacy in SSO system. It is defined that when the proxy can keep IdP and RP anonymous to each other and itself the proxy is called the triple blind proxy. But no existing proxy has achieved this goal.
%that the triple blind proxy can protect users from being tracked, but there is no existing systems achieved this goal.
%Moreover, the protocols protecting user's privacy (such as, SPRESSO and BrowserID) are quite distinct from the widely adopted protocols. There is to be a huge cost if IdP developers migrate their systems into a totally brand-new architecture.
%第四段
%IdP钓鱼网站问题
%转移到安全分析
%Besides tracking user, IdP in traditional SSO system is not expected to protect users from phishing attack either. Imagine that you visit \emph{phishingsite.com} which is established by a malicious opponent and allows user to log in using a Google account. Google SSO allows web application to direct user to Google's login web page and user need log in Google. However, \emph{phishingsite} directs you to a phishing site totally same as Google's web page instead of the real one. That is, while you accomplish the authentication, e.g., inputting your password, your password is to be stolen by malicious opponent.

%Phishing attack in SSO systems has been considered by OAuth 2.0~\cite{rfc6749} and several papers~\cite{anti_phishing}~\cite{devil_phishing}~\cite{mechanism_phishing} are proposed to discuss it. There is, however, no existing schemes can be adopted to enhance the security of popular protocols, e.g., OpenID Connect.


%In this paper, we propose an extension (named PriOIDC) of existing widely adopted SSO system (i.e., OIDC), which preserves the systematically and thoroughly analyzed security, and achieves the fully privacy. That is, (1) the security design in OIDC is inherited to prevent the impersonation attack and  identity injection attack, (2) the privacy enhance mechanisms (e.g., the clear consent from the user and the PPID) are retained, (3) a new mechanism is introduced to hide the user's accessed RP from IdP. Unlike designing and deploying a new SSO systems, we only need to analyze the compliance of the new function (i.e., hiding the user's accessed RP) and the influence to the security introduced by the new mechanism. And, the deployment of PriOIDC only requires: (1) IdP provides a set of public parameters and generates the PPID with a newly provided algorithm, (2) RP integrates the SSO service with a new version software development kit (SDK) whose interface remains unchanged, (3) the user installs an extension to access RP with full privacy anywhere as no persistent storage is required in the user side.

%第⑤段：
%我们的目标
%建立一套新的单点登录系统，满足：
%1 满足NIST的隐私需求
%2 便于现有系统的迁移
%To hide the user's accessed RP from IdP, PriOIDC avoids the potential leakage in the identity proof (i.e., id token in OIDC)  and the corresponding message transmission. Moreover, PriOIDC enables only the RP (and the user) to derive the user's unique identifier from different PPIDs,  which  allows the RP to provide the individual service with the unique identifier and avoids the user linkage as both the PPID and user's unique identifier in RP are different for various RPs. PriOIDC achieves these as follows:
%\begin{itemize}
%\item A new algorithm is proposed to negotiate the RP's identifier between the user and RP for each login. Therefore, the RP's identifier in multiple id tokens are different, and IdP fails to infer RP's information in the generation of one or multiple id tokens. Moreover, neither RP nor the user may control the generated identifier, which avoids the misuse of the id token. The detailed analysis is provided  in Section~\ref{sec:analysis}.
%\item A browser extension is introduced to transmit the messages (i.e.,  request and response) related with the id token. IdP fails to infer the RP's information through the network traffic, and the extension ensures only the correct RP receives the id token.
%\item A new generation algorithm of PPID is provided, which makes the PPIDs for one user in one RP  indistinguishable  from others (e.g., different users in different RPs), while only the RP (and the user) has the trapdoor to derive the unique identifier from different PPIDs for one user in one RP.
%\end{itemize}


%第六段
%我们的贡献
%提出协议
%考虑能否根据模型进行分析
%实现原型系统
The main contributions of Recluse are as follows:
\begin{itemize}
\item We systematically analyze the privacy issues in SSO systems and propose a comprehensive protection solution to hide users' traces from both curious IdPs and colluding RPs, for the first time.
%deals with all the privacy issues introduced by SSO comprehensively. It has the ability to prevent IdP from tracking users' login trace, as well as multiple RPs are unable to link the users either.
%pratical extension for OIDC, which inherits the systematically and thoroughly analyzed  security and privacy mechanisms of OIDC, and achieves the full privacy for users by hiding the accessed RPs from IdP.
\item We develop a prototype of Recluse that is compatible with OIDC and demonstrate its effectiveness and efficiency with experiment evaluations.
\item We provide a systematic analysis to show that Recluse achieves the same level of security as existing SSO systems while providing a stronger privacy protection.
\end{itemize}



%第七段
%文章结构
The rest of this paper is organized as follows. We introduce the background in Sections~\ref{sec:background}, and the challenges with solutions briefly~\ref{sec:challenge}. Section~\ref{sec:related} and Section~\ref{sec:Recluse} describe the threat model and the design of Recluse. A systematical analysis is presented in Section~\ref{sec:analysis}. We provide the implementation specifics and evaluation in Section~\ref{sec:implementation}, then introduce the related works in Section~\ref{sec:related}, and draw the conclusion finally.
% and Section~\ref{sec:evaluation}

%This paper is organized as follows: Section~\ref{sec:back} provides the knowledge of OpenID Connect. Section~\ref{sec:overview} gives the overview of this scheme and its attack surface. Section~\ref{sec:protocol} describes the construction and details of this scheme. Section~\ref{sec:analysis} provides the detailed analysis of the new scheme. Section~\ref{sec:evaluation} offers a performance evaluation of our prototype system. Section~\ref{sec:related} discusses the related works. In Section~\ref{sec:conclusion}, a conclusion is given.



\begin{comment}
%These protocols are classified into two classes according to the objective:
%(1) preventing the RP obtaining the user's identity and (2) avoiding the IdP learning at which RP the user logins in.
Anonymous SSO authentications schemes belonging to the first one and apply to the RPs who do not require the user's identity nor PII, and just  need to check whether the user is authorised or not. These schemes allow users to access a service protected by a verifier without revealing their identities to the RPs.

However, to provide the continuous and preconized service, RP needs to obtain the unique pseudonym for each user.
In this case, the solutions belong to the class 2 is more suitable, as the IdP doesn't know which RP the user access while the RP only knows the user's pseudonym but not the real identity.
Vairous SSO protocols are proposed to hide the users accessed RPs from the IdP.
In the BrowserID system~\cite{persona}, the user sends RP the user certificate (i.e. combing the user's email address with the user's public key) and identity assertion (i.e., the origin of the RP signed by the user with the corresponding private key) to complete the authentication, and is formally analyzed and found severe attacks~\cite{BrowserID}.
SPRESSO~\cite{SPRESSO} is proposed based on the standard HTML5 and web features, and formally analyzed based on the expressive Dolev-Yao style model of the web infrastructure~\cite{webmodel}.





For security consideration, the ticket issued by the IdP should contain the identity of RP, to send the ticket or ticket index, the IdP should construct the rediect URL which contains the  RP URL.

%大量工作来提升协议的安全性，包括1.协议本身的安全性；2. 具体实现的安全性。
The security of SSO systems is improved by .
The OAuth 2.0 and OpenId-Connect protocol are formally analyzed under the web model.
The implementations have been evaluated and various vulnerabilities are found which
%Authentication is the first line to protect the user information,

%SSO引入了新的隐私问题，目前已有多项工作1. 协议规范要求IdP在向RP传输PII时，需要得到用户明确授权；2.用户在不同RP使用的不同的标识，防止串联 3.匿名SSO，防止RP获取用户信息


%但是SSO引入了一个明显的问题，即IdP将获取用户访问的RP信息，从而能够***


%本文提出了一种匿名方案，通过集成***，实现了。可以描述该工作的难点





A Single Sign-On (SSO) system contains Identity Provider (IdP), Relying Parties (RP) and users. It allows users to log in the IdP once and then user can use RPs' service without extra login. Currently internet services have been an essential part of people's life. To provide their users with personalized services, many web application developers manage to authenticate users. Traditional authentication system requires users to keep individual accounts and passwords.

%SSO引入了新的安全问题 However, SSO introduces new risk to the user's privacy.
Introduce the flaws of current sso system. All the popular sso protocols can't hide the login information , who login in which web application. And even the specification of some protocols advise the IdP should keep the user identity unique in each RP, but may sso service providers haven't confirm the rule, such as Google.

%现有的缓解方法
Introduce what we want about the sso system. When the user logs in a RP with the sso service, the IdP will get nothing can link the user an the RP. And even the multi-RP collusion cannot deduces the user's login trace.

%但是现有解决方法还不够，引入我们的问题
Our contributions:

%我们方法的基本原理

\end{comment}
