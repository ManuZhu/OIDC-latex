\section{Related Works}%各个方向全都加入，例如安全分析
\label{sec:related}
%SSO was first proposed in **.
%Now, the typical SSO standards include Kerberos~\cite{Kerberos}, SAML, OAuth, OIDC and CAS\cite{aubry2004esup}, which has been adopted and implemented by Google, Facebook, Twitter and other systems.
%In 2014, Chen et al.\cite{ChenPCTKT14} concludes the problems developers may face to in using sso protocol. It describes the requirements for authentication and authorization and different between them. They illustrate what kind of protocol is appropriate to authentication. And in this work the importance of secure base for token transmission is also pointed.
%The NIST SP800-63C~\cite{NIST2017draft} issues the security and privacy considerations about SSO systems. And the supplementary standards of widely deployed SSO~\cite{rfc6819} systems also indicate the key points of authentication, where the importance of secure base for token transmission is also pointed.
Various SSO  standards have been proposed and widely deployed. For example, OIDC is adopted by Google, OAuth 2.0 is deployed in Facebook, SAML is implemented in the Shibboleth project~\cite{Shibboleth}, and Central Authentication Service (CAS)~\cite{aubry2004esup} is widely adopted by Java applications. 
Kerberos~\cite{Kerberos}, proposed by MIT, is now replaced by the SSO standards (e.g., OIDC, OAuth) who provide better privacy, as the users in Kerberos fail to control on the releasing of their private information.

Impersonation attack and identity injection, were found in different SSO implementations. These attacks exploit the vulnerabilities in the SSO implementations 
to break at least one of the requirements, i.e., confidentiality, integrity and binding of identity proof.
%Various attacks were proposed for the impersonation attack and identity injection, by breaking the confidentiality, integrity and binding of identity proof, 
%and extensive efforts have been devoted to the security considerations of SSO systems. 
%analysis of 14 major SAML frameworks and show that 11 of them, including Salesforce, Shibboleth, and IBM XS40, have critical XML Signature wrapping (XSW) vulnerabilities
XML Signature wrapping (XSW) vulnerabilities were found in 11 major SAML implementations (e.g., the ones provided by Salesforce, Shibboleth, and IBM XS40)~\cite{SomorovskyMSKJ12}, which was used to break the integrity of identity proof.
%Juraj et al.\cite{SomorovskyMSKJ12} breaks the integrity, by exploiting the XSW vulnerabilities to  insert malicious elements in 11 SAML frameworks. 
Wang et al.~\cite{WangCW12} performed a traffic analysis on SSO implementations provided by Google and Facebook, and broke the integrity and confidentiality to sign onto the victim's account.
%, including bypassing the verification of signature (braking integrity), leaking of identity proof (breaking confidentiality) and so on.
%In 2014 Zhou et al.~\cite{ZhouE14}, in 2016 Wang et al.~\cite{WangZLG16} and Yang et al.~\cite{YangLLZH16} built the automatic tester to analyse the implementations of existing applications and achieve the statistical result of these applications. 
%The usual vulnerabilities found in these works includes, 1) using bearer token for authentication (break binding); 2) using publicly accessible information as identity proof (breaking confidentiality); 3) client-side protocol logic (breaking integrity) and so on. 
The vulnerabilities~\cite{ZhouE14,WangZLG16,YangLLZH16} were found in the RP's implementations of OAuth, for example, the bearer token or publicly accessible information is misused as the identity proof which allows the breaking of binding or confidentiality, the incomplete verification at the client breaks the integrity.


%GhasemisharifRC18 描述的是一旦用户在IdP账户compromise后，所引起的危害（所有关联的RP账户的泄露），并提出了a backwards-compatible extension (single sign-off) for OIDC for correct permission revocation
%We present an in-depth empirical evaluation of the implications of an IdP account compromise, and perform a systematic analysis of the subsequent account authorization and creation process under several novel attack scenarios for 95 of the most popular web and mobile RPs. Our findings offer a comprehensive evaluation of the SSO threat landscape. We demonstrate the inherent inability of popular SSO systems to prevent adversaries from maintaining access to users’ RP accounts even after permission revocation. As such, we design single sign-off, a backwards-compatible extension to OpenID Connect that addresses this threat.

%MainkaMS16 针对OpenID，描述的是恶意的IdP影响到RP集成的其他正确IdP上的用户信息，主要是 ID Spoofing: 恶意的IdP以正确的IdP名义签发identity proof；Key Confusion 让RP以为恶意IdP的key是对应正确IdP的。
%We found two novel classes of attacks, ID Spoofing (IDS) and Key Confusion (KC), on OpenID, which were not covered by previous research. Both attack classes allow compromising the security of all accounts on a vulnerable SP, even if those accounts were not allowed to use the malicious IdP.
%MainkaMSW17 是将MainkaMS16 用到OpenID connect的自动化工具

%ArmandoCCCPS13 针对SAML和OpenID，攻击者利用浏览器的漏洞，将用户与RP之间的cookie发送给了恶意的RP，破坏机密性。具体地，就是讲恶意的js代码插在relaystate参数中，破坏同源策略。
%As we can see in the figure, c requires a resource from a compromised SP i; i, acting in turn as a client, receives from sp an Authentication Request, and passes it back to c, with the malicious code injected into theRelayState. The client’s browser eventually executes the redirection to the maliciously-crafted URI, as if coming from the Google domain (thus circumventing the same origin policy). This redirection leads to the theft of theHID, HUSR, and ASIDAScookies by sp.

%CaoSBKVC14 指出impersonation attacks的root cause是IdP和RP之间没有一个安全信道实现机密性和完整性，其introduce a dedicated, authenticated, bidirectional, secure channel，具体的是针对RP标识，不再使用一个随机的appid，而是 an unforgeable identifier to represent the identity of an RP（直接用他的域名 the identity of the RP is its web origin）；安全信道是按需建立类似于TLS的双向认证通道，且使用完之后销毁。
%YangLCZ18 开发了一个针对OAuth SDK的分析工具，发现了包括Facebook在内的SDK，存在use-before-assignment of state variable，Bypass MAC key protection，refresh token injection，access token injection等漏洞。refresh token injection和access token injection 破坏了binding，token没有和RP绑定。use-before-assignment of state variable允许了CSRF攻击（making CSRF attack possible again），这个靠不上三个基本要求，是实现上的，替换了state，使得RP将攻击者请求（响应）和受害者响应（请求）关联了，即将一个session和非对应的实体绑定了。Bypass MAC key protection也是破坏了 MAC key和RP绑定。
Moreover, the malicious IdP is also considered, where in 2018 the Mohammad et al.~\cite{GhasemisharifRC18} demonstrated the vulnerabilities and protect of IdP account hijack, which is the single failure in SSO systems and in 2016 and 2017 Christian et al.~\cite{MainkaMS16, MainkaMSW17} proposed the corrupted IdP might compromise the account in the RP associated with other IdPs, which break the confidentiality and integrity of SSO systems. Besides, other analysis about SSO systems in various directions, such as in 2013 Armando et al.~\cite{ArmandoCCCPS13} issued the specific code injection in Google SSO system results in the impersonate attack, in 2014 Cao et al.~\cite{CaoSBKVC14} discussed about the security of communication channel between the RP and the IdP and in 2018 Yang et al.~\cite{YangLCZ18} analysed the SDK implementation of OAuth 2.0, which are concerned as the confidentiality vulnerabilities in SSO systems.


%Besides of OAuth 2.0 and OpenID Connect 1.0, Juraj et al.\cite{SomorovskyMSKJ12} find XSW vulnerabilities which allows attackers insert malicious elements in 11 SAML frameworks. It allows adversaries to compromise the integrity of SAML and causes different types of attack in each frameworks.

The SSO is also adopted in the mobile application, for example, Google, Facebook and other IdPs have already provided the mobile SSO service. However, new attacks were found, as the mobile applications fails to ensure the confidentiality, integrity and binding. In 2014 Chen et al.~\cite{ChenPCTKT14} generally demonstrated the difference between authentication and authorization and the challenges introduced by the migration of SSO systems from web platform to mobile application. The differences between mobile and web platform, such as using application instead of browser for SSO systems, introduce the additional vulnerability not available on web platform. Using mobile application for SSO results in the lack of trustful identity proof transmission breaking the confidentiality of SSO systems which is ensured by the redirection in browser. In 2016 Mohsen et al.~\cite{MohsenS16} proposed the security of SSO systems implemented through WebView, one of the most important Android components, also facing the threaten of untrusted identity proof transmission.
 Moreover, in 2016 Wang et al.~\cite{WangZLG16} analysed the design and implementation of SSO systems for multiple platforms with the automatic testing. In 2015 Wnag et al.~\cite{WangZLLYLG15}, in 2017 Yang et al.~\cite{YangLS17} and in 2019 Shi et al.~\cite{ShiWL19} issued the new vulnerabilities in mobile SSO systems and conducted security assessments for the top Android applications and and achieve the statistical result of these applications.




The comprehensive formal security Analysis were performed on SAML, OAuth and OIDC. Firstly in 2008 Armando et al.~\cite{ArmandoCCCT08} built the formal model of the protocol implemented in the SAML-based Google SSO system and revealed that the malicious RP might reuse the identity proof to impersonate the user visiting other RPs which breaks the binding of identity proof. In 2016 and 2017 Fett et al.~\cite{FettKS16, FettKS17} conducted the formal analysis of the OAuth 2.0 and OpenID Connect standards using an expressive Dolev-Yao style model, and found the flaws in the implementation of SSO systems, including 307 redirect wihch might expose credential and IdP Mix-Up resulting in the leakage of identity proof (breaking confidentiality). Finally, it is proved that OAuth 2.0 and OpenID Connect satisfies the authorization and authentication requirements with the fixes, for example, using 302 redirect instead of 307 redirect and RP provides a unique redirection endpoint for each IdP. Besides, in 2015 Ye et al.~\cite{YeBWD15} performed a formal analysis on the implementation of Android SSO systems and identified a major vulnerability in the existing Facebook Login implementation on Android system, which allows a malicious app to achieve the credentials of victim’s Facebook account.

%In 2016, Daniel et al.\cite{FettKS16} conduct comprehensive formal security Analysis of OAuth 2.0. In this work, they illustrate attacks on OAuth 2.0 and OpenID Connect. Besides they also presents the snalysis of OAuth 2.0 about authorization and authentication properties and so on. Other security analysis\cite{WangCW12}\cite{ZhouE14}\cite{WangZLG16}\cite{YangLLZH16}\cite{WangZLLYLG15} on SSO system concludes the rules SSO protocol must obey with different manners.


As suggested in NIST SP800-63C~\cite{NIST2017draft}, user's privacy should be protected in SSO systems, which is partially achieved in the SSO standards, BrowerID and SPRESSO.
The user's privacy protection in SSO systems includes, 1) the user should be able to control the range of the attributes exposed to the RP, 2) multiple RPs should fail to link the user through collusion, 3) IdP should fail to obtain the trace of RPs accessed by a user and employ technical measures, such as the use of pairwise pseudonymous to prevent the user linkage among multiple RPs.
In 2014 Chen et al.~\cite{ChenPCTKT14} and in 2016 Yang et al.~\cite{YangLLZH16} illustrated the security and privacy consideration so OAuth 2.0 system about notification which immigrates the first 2 privacy issues. Similarly, the guideline of OIDC~\cite{OpenIDConnect} requires the End-User consent for the release of the user's information.
The guidelines of OIDC~\cite{OpenIDConnect} and SAML~\cite{SAML} suggests that the IdP should provide the pairwise user identifier.
However, the widely deployed SSO systems are all unable to prevent the IdP from tracing the user. To achieve the goal of protecting user from being tracked by IdP, in 2013 Mozilla proposed the Persona~\cite{persona} based on the BrowserID protocol~\cite{BrowserID}, which is now migrated to Firefox Accounts~\cite{FirefoxAccount}. BrowserID enables the RP to identify the user through the login request signed by user's private key and the key is bound with user's email by IdP who need not know the  RP's identity. In 2014 and 2015, Fett et al.~\cite{FettKS14, BrowserID} performed the formal analysis on the BrowserID and finally found the flaw in it. In 2015 Fett et al.~\cite{SPRESSO} proposed SPRESSO, the privacy-preserving SSO system, which enables the IdP to issue the identity proof for the encrypted RP identifier which does not expose RP's identity. However, no existing SSO systems protect user's login trace from both IdP tracking and RPs linking the user.

%The first property is satisfied in most SSO systems. For example, in OAuth, OIDC and SAML, IdP exhibits the attributes requested by the RP and sends the attributes to the RP only when the user has provided a clear consent, which may also minimize the exposed attributes as the user may disagree to provide partial attributes.
%BrowserID\cite{BrowserID}\cite{FettKS14} is a user privacy respecting SSO system proposed by Molliza. BrowserID allows user to generates asymmetric key pair and upload its public to IdP. IdP put user's email and public key together and generates its signature as user certificate (UC). User signs origin of the RP with its private key as identity assertion (IA). A pair containing a UC and a matching IA is called a certificate assertion pair (CAP) and RP authenticates a user by its CAP. But UC contains user's email so that RPs are able to link a user's logins in different RPs.
%SPRESSO\cite{SPRESSO} allows RP to encrypt its identity and a random number with symmetric algorithm as a tag to present itself in each login. And token containing user's email and tag signed by IdP is also encrypted by a symmetric key provided by RP. During parameters transmission a third party credible website is required to forward important data. As token contains user's email, RPs are able to link a user's logins in different RPs.


Anonymous SSO scheme is proposed to hide the user's identity to both the IdP and RPs, which can only be applied to the services that do not need the user's unique identifier.
One of the earliest anonymous SSO system is proposed by Elmufti et al.~\cite{ElmuftiWRR08} in 2008 for Global System for Mobile (GSM) communication. In 2013 Wang et al.~\cite{WangWS13} formalized the notion of anonymous single sign-on and proposed the anonymous based on group signatures. Moreover, in 2018 Lee et al.~\cite{Lee18} proposed the anonymous SSO system  based on Chebyshev chaotic-map-based assumptions and in 2018 Han et al.~\cite{HanCSTW18} proposed the system based on zero-knowledge proof. However, as the anonymous SSO system hides the user's identity from both IdP and RP, it is impossible for RP to provide personalize service to specific user.

%Anonymous SSO schemes prevents the IdP from obtaining the user's identity for RPs who do not require the user's identity nor PII, and just need to check whether the user is authorized or not. These anonymous schemes, such as the anonymous scheme proposed by Han et al.~\cite{HanCSTW18}, allow user to obtain a token from IdP by proving that he/she is someone who has registered in the Central Authority based on  Zero-Knowledge Proof. RP is only able to check the validation of the token but unable to identify the user.
%In 2018, Han et al.\cite{HanCSTW18} proposed a novel SSO system which uses zero knowledge to keep user anonymous in the system. A user is able to obtain a ticket for a verifier (RP) from a ticket issuer (IdP) anonymously without informing ticket issuer anything about its identity. Ticket issuer is unable to find out whether two ticket is required by same user or not. The ticket is only validate in the designated verifier. Verifier cannot collude with other verifiers to link a user's service requests. Same as the last work, system verifier is unable to find out the relevance of same user's different requests so that it cannot provide customization service to a user. So this system is not appropriate for current web applications.
%In 2010, Han et al.\cite{HanMSY10} proposed a dynamic SSO system with digital signature to guarantee unforgeability. To protect user's privacy, it uses broadcast encryption to make sure only the designated service providers is able to check the validity of user's credential. User uses zero-knowledge proofs to show it is the owner of the valid credential. But in this system verifier is unable to find out the relevance of same user's different requests so that it cannot provide customization service to a user. So this system is not appropriate for current web applications.
%In 2013, Wang et al. proposed anonymous single sign-on schemes transformed from group signatures. In an ASSO scheme, a user gets credential from a trusted third party (same as IdP) once. Then user is able to authenticate itself to different service providers (same as RP) by generating a user proof via using the same credential. SPs can confirm the validity of each user but should not be able to trace the user’s identity.
