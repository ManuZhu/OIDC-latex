\subsection{Performance Evaluation}
\label{sec:evaluation}
Three machines connected in an isolated 1Gbps LAN,
    build the experimental SSO environment.
The CPUs are Intel Core i7-4770 3.4 GHz for the IdP,
    Intel Core i7-4770S 3.1 GHz for the RP, and Intel Core i5-4210H 2.9 GHz for users.
Each machine is configured with 8 GB RAM and
    installs Windows 10 as the operating system.
The user agent is Chrome v75.0.3770.100.

%RP（不包括特定方案的SDK）大约需要230行JAVA代码
%OIDC（MITREid）的SDK需要大约20行的JAVA代码，需要额外添加一个HTML文件（包含大约20行JavaScript代码）
%UPPRESSO的SDK需要大约1100行代码，不需要添加额外的HTML文件
%OIDC和UPPRESSO的SDK只需要RP提供两个网络接口（网址），然后在对应的网络接口中引用对应的API（每个接口对应一个API，分别命名为tokenRequestGenerate和userAccountAchieve），其他的处理流程均由SDK完成
%SPRESSO由于结构与OIDC完全不同，所以使用了SPRESSO提供的RP的开源代码
%For better evaluation, we build one RP for both UPPRESSO and MITREid Connect which is also implemented  based on Spring Boot framework, as well as the identity token transmission from user to RP in MITREid Connect is implemented by JavaScript running in RP's web page. The IdP in MITREid Connect is achieved from github \cite{MITREid}. However, the SPRESSO system is downloaded from \cite{spressome} containing IdP, RP and FWD.

%A DELL OptiPlex 9020 PC (Intel Core i7-4770 CPU, 3.4GHz, 500GB SSD and 8GB RAM) with Window 10 prox64 works as the IdP. A ThinkCentre M9350z-D109 PC (Intel Core i7-4770s CPU, 3.1GHz, 128GB SSD and 8GB RAM) with  Window 10 prox64 servers as RP. The user adopts Chrome v75.0.3770.100 as the user agent on the Acer VN7-591G-51SS Laptop (Intel Core i5-4210H CPU, 2.9GHz, 128GB SSD and 8GB RAM) with  Windows 10 prox64. For SPRESSO, the extra trusted entity FWD is deployed on the same machine as IdP.
%没有因为部署在同一个机器上使得开销变长，monitor指系统的监视器
%The monitor demonstrates that the calculation and network processing of the IdP does not become a bottleneck (the load of CPU and network is in the moderate level).

We compare UPPRESSO with MITREid Connect \cite{MITREid} and SPRESSO \cite{SPRESSO}.
In the evaluation,
    MITREid Connect runs with the standard implicit login flow of OIDC,
 while the identity tokens signed by the SPRESSO IdP are also forwarded by users to the RP,
    similarly to the implicit login flow of OIDC.
In the identity tokens of SPRESSO, $ID_{RP}$ is the encrypted RP domain, while the one-time symmetric key only known by RP and user.
They also configure RSA-2048 and SHA-256 as the signature algorithm and the hash function in the generation of identity tokens, respectively.


MITREid Connect provides open-source Java implementations of IdP and
RP SDK,
 while SPRESSO implements all entities by JavaScript based on node.js.
We then implemented the RPs based on Spring Boot for UPPRESSO and MITREid Connect, by integrating the corresponding SDK.
The RPs in three schemes provide the same function, i.e.,
     extract the user's account from verified identity tokens.

We measured the time for a user to login to the RP
     and calculated the average values of $1,000$ measurements.
We divide a login instance into 3 phases:
{\em Preparation and identity token requesting} (Steps 1-3 in Figure \ref{fig:process}),
 the RP (and user) constructing and transmitting the request to IdP;
{\em Identity token generation} (Step 4 in Figure \ref{fig:process}),
    the IdP generating identity token (no user authentication);
and {\em Identity token acceptance} (Step 5 in Figure \ref{fig:process}),
    the RP server receives, verifies and parse the identity token relayed from the IdP.
% and \textbf{Identity token verification} (Steps 5.1 and 5.2 in Figure \ref{fig:process}), the RP verifying and parsing the identity token.

The evaluation results are shown in Figure \ref{fig:evaluation}.
The overall SSO login times are  113 ms, 308 ms, and 310 ms for MITREid Connect, SPRESSO, and UPPRESSO, respectively.
The significant overhead  in UPPRESSO is opening the new window and downloading the script from IdP, which needs about 104 ms.
This overhead could be reduced by implicitly conducting this procedure when the user visits the RP website.


\begin{figure}
  \centering
  \includegraphics[width=0.9\linewidth]{fig/evaluation2.pdf}
  \caption{The time cost of SSO login flow.}
  \label{fig:evaluation}
\end{figure}

In the requesting, UPPRESSO requires 271 ms in total.
The significant overhead  in UPPRESSO occurs when opening the new window and downloading the script from IdP,
 which needs about 104 ms.
SPRESSO needs 19 ms for the RP to obtain IdP's publicly accessible information, e.g., public key (SPRESSO allows a user to  assign any IdPs before login without prior registration) and encrypt its domain using a newly generated symmetric key.
MITREid Connect only needs 10 ms.



%估计能减少多少，
In the generation, UPPRESSO needs in total 34 ms, including computing $PID_U$, compared to MITREid Connect which only needs 32 ms.
SPRESSO requires 71 ms, as it implements the IdP based on node.js and therefore can only adopt a JavaScript cryptographic library,
 while others adopt a more efficient Java library.
%As the processings in SPRESSO and MITREid Connect are the same, the processing time in SPRESSO may be reduced to 32 ms.
%And, then the overall time in SPRESSO will be 269 ms, still larger than 254 ms in UPPRESSO.

%transmission & extraction
In the identity token acceptance, UPPRESSO only needs about 6 ms. % where the scripts relay the identity token to the RP server, and RP server verifies and parses the token.
MITREid Connect requires the IdP to send the identity token to the RP's web page which then sends the token to the RP
 through a JavaScript function, and needs 71 ms
 (The token carried within an URL must follow the fragment identifier \verb+#+ instead of the \verb+?+, for security considerations~\cite{de2014oauth}. As the parameters after the fragment identifier \verb+#+ will not be sent to server during an HTTP request, therefore, while the token response is redirected to the RP's server, the script must be downloaded from RP to parse the token and post it to server.).
SPRESSO needs the longest time (210 ms) due to the complicated processing at the user's browser.
  %which needs the browser to obtain identity tokens from the IdP, download the JavaScript program from a trusted entity (forwarder), execute the program to decrypt RP's endpoint, send identity tokens to this endpoint (an RP's web page) who finally transmits the token to RP server.
%In the evaluation, the forwarder and IdP are deployed in one machine, which doesn't introduce performance degradation based on the observation. % as  FWD and IdP work sequently for one login.

%SPRESSO needs a trusted entity named FWD for transmitting the identity token. We deployed FWD and IdP on the same machine to reduce transmitting delay between them, while the computation never becomes the bottleneck according to the observation.


%In the verification, UPPRESSO needs an extra calculation for $Account$, which then requires  58 ms,
% compared to 14 ms in MITREid Connect and 17 ms in SPRESSO.
