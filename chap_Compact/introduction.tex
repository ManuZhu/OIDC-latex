\section{Introduction}
\label{sec:intro}

%SSO的特点
%SSO的现状
Single sign-on (SSO) systems, such as OpenID Connect~\cite{OpenIDConnect}, OAuth~\cite{rfc6749} and SAML~\cite{SAML}, have been widely deployed as the identity management and authentication infrastructure in the Internet.
SSO enables a website, called the \emph{relying party} (RP), to delegate its user authentication to a trusted third party called the \emph{identity provider} (IdP).
Thus, a user visits multiple RPs with only a single explicit authentication attempt at the IdP.
With the help of SSO, a user no longer needs to remember multiple credentials for different RPs;
 instead, she maintains only the user credential for the IdP, which generates \emph{identity proofs} for her visits to these RPs.
%        Moreover, SSO shifts the burden of user authentication from RPs to IdPs and reduces security risks and costs at RPs.
SSO has been widely integrated with many application services.
For example,
    we find that 80\% of the Alexa Top-100 websites~\cite{Alexa} support SSO,
 and the analysis on the Alexa Top-1M websites~\cite{GhasemisharifRC18} identifies 6.30\% with the SSO support.
Meanwhile, many email and social network providers (such as Google, Facebook, Twitter, etc.)
    are serving the IdP roles in the Internet. %social identity providers to support social login.


%SSO系统的安全问题，需要保护identity proof的完整性，机密性，绑定性
%完整性：使用公开的为受保护的信息作为identity proof
%机密性：保证由IdP发送给对应的RP，并且传输过程中通道、user agent都是受到保护的
%绑定性：identity proof一定要与对应的RP实现绑定
%SPRESSO中关于impersonation和identity injection的描述。 Authentication is the most fundamental security property of an SSO system. That is, i) an adversary should not be able to log in to an RP, and hence, use the service of the RP, as an honest user, and ii) an adversary should not be able to log in the browser of an honest user under an adversary’s identity (identity injection).
%这段描述两个事情：1.secure authentication 就是能防住impersonation和identity injection。 然而，现在有很多攻击使得这两个无法得到保证。经过分析主要是这三个方面的原因：1)RP接受了未被完整性保护的内容；2)未绑定；3)泄露。
%binding 原文描述 ChenPCTKT14 CCS14 Friendcaster(Friendcaster是一款Facebook的第三方应用，比官方版的功能更加全面) blindly accepting an access token received from a user's device then using this token to exchange for the user's Facebook ID. A malicious application could obtain a legitimate access token from a user, then use this access token to log into Friendcaster as the user. cause they thought Facebook's access tokens were bound to relying parties and checked with every API call: \From Facebook's perspective, the API calls wouldn't appear to be originating from Friendcaster, but the attacker's own app."
%完整性原文描述 IEEE S&P2012~\cite{WangCW12}关于Google问题描述we found that the RPs of Google ID SSO often assume that message fields they require Google to sign would always be signed, which turns out to be a serious misunderstanding (Section 4.1). These problems make us believe that a complete answer to our question can only be found by analyzing SSO schemes on real websites.

% Move to section III
%The primary goal of SSO services is to implement secure user authentication~\cite{SPRESSO}, i.e., to ensure that an honest user can always log in to an honest RP under the correct account. To achieve this, an identity proof generated by the IdP should explicitly specify the authenticated user (i.e., \emph{user identification}) and the RP to which the user attempts to log in (i.e., \emph{receiver designation}). The identify proof should be received only by that RP and user but not by any other entities (i.e., \emph{confidentiality}) and verified by the receiver (i.e., \emph{integrity}). However, various attacks exploit vulnerabilities in different SSO systems to break at least one of these requirements~\cite{ChenPCTKT14, FettKS16,WangCW12,ZhouE14,WangZLG16,YangLLZH16,SomorovskyMSKJ12,MohsenS16}, where the adversaries attempt to either impersonate the victim user at an honest RP or %manipulate the victim user's browser to log in to honest RPs under the adversary's identity. %(i.e., identity injection). For example, Friendcaster was found to accept any received identity proof~\cite{ExplicatingSDK,ChenPCTKT14} (i.e., a violation of receiver designation) so that a malicious RP could log in to Friendcaster as the victim user by replaying the identity proof received from the user to Friendcaster~\cite{MohsenS16}. \cite{WangCW12} reported that some RPs of Google ID SSO accepted user attributes that were not tied to the identity proof (i.e., a potential violation of integrity). As a result, a malicious user could insert arbitrary attributes (e.g., an email address) into the identity proof to impersonate another user at the RP.


%SSO 引入新的隐私问题
%IdP知道用户登录哪个RP
%RP之间可以合谋知道同一个用户登录哪些RP
The adoption of SSO also raises privacy concerns regarding online user tracking and profiling~\cite{maler2008venn,NIST2017draft}.
User privacy leaks in all existing SSO protocols and implementations.
Taking a widely used SSO protocol, OpenID Connect (OIDC), as an example, we explain its login process and the risk of user privacy leakage. %As shown in Fig.~\ref{fig:OpenID},
On receiving a user's login request, % (Step 1),
 the RP constructs a request of identity proof with its identity and redirects it to the IdP. % (Step 2).
After authenticating the user, the IdP  generates an identify proof binding the identities of the user and the RP, %in Step 4,
 which is forwarded to the RP by the user. %in Step 5.
Finally, the RP verifies the identity proof and allows the user to log in.
From such login instances, any curious IdP or collusive RPs could break the users' privacy as follows.
\begin{itemize}
\item {\em IdP-based login tracing}. The IdP knows the identities of the RP and the user in each single login instance, %in Step 2 and Step 3, respectively.
        to generate the identity proof.
        As a result, a curious IdP could discover all the RPs that the victim user attempts to visit and profile her online activities.
\item {\em RP-based identity linkage}. The RP learns a user's identity from the identify proof.
When the IdP generates identity proofs for a user, if the same user identifier is bound in identity proofs generated for different RPs, % or the user's identifiers can be derived from each other,
which is the case of several widely deployed SSO systems~\cite{FirefoxAccount}, malicious RPs could collude to not only link the user's login activities at different RPs for online tracking but also associate  her attributes across multiple RPs~\cite{maler2008venn}.
\end{itemize}


%google and facebook的负面新闻
%1. service provider（如DNS）知道你访问了，可以带来很多问题。但是还是不同的，DNS里profile需要评估的是two behavior vectors的similarities，而IdP中都不需要，因为IdP能够区分two behavior vectors 是否来自相同节点。

Large IdPs, especially the social IdPs such as Google and Facebook, are interested in collecting users' online behavioral information for various purposes (e.g., Screenwise Meter~\cite{googlenews} and Onavo~\cite{Onavo}).
 By simply serving the IdP role, these companies will easily collect a large amount of data to reconstruct users' online traces.
On the other hand, in the Internet, many service providers host a variety of web services and therefore take an advantaged position to link a user's multiple logins at different RPs.
Through the internal information integration, rich information will be obtained from the SSO data for user profiling.
Meanwhile, the technologies  of privacy-preserving record linkage~\cite{agrawal2003information} and private set intersection~\cite{de2010practical} allow multiple organizations (e.g., RPs) to share and link the data without directly sharing their clients' data,
 which pave the path for cross-organizational RP-based identity linkage.

While the privacy problems in SSO have been widely recognized~\cite{maler2008venn,NIST2017draft}, only a few solutions were proposed to protect user privacy~\cite{BrowserID,SPRESSO}. Among them, Pairwise Pseudonymous Identifier (PPID)~\cite{OpenIDConnect, SAMLIdentifier} is a straightforward and commonly adopted solution to defend against RP-based identity linkage.
It requires the IdP to create different identifiers for the user when she logs into different RPs,
 so that the pseudo-identifiers of the same user cannot be used to link the user's logins at different RPs even if they collude.
 As a recommended practice by NIST~\cite{NIST2017draft}, PPID has been specified in many widely adopted SSO standards including OIDC~\cite{OpenIDConnect} and SAML~\cite{SAMLIdentifier}. However, PPID-based approaches cannot prevent the IdP-based login tracing attacks, as the IdP still knows which RP the user visits.

To the best of our knowledge, only two schemes (i.e., BrowserID~\cite{BrowserID} and SPRESSO~\cite{SPRESSO}) have been proposed so far to defend against IdP-based login tracing.
In BrowserID (and its prototypes known as Mozilla Persona~\cite{persona} and Firefox Accounts~\cite{FirefoxAccount}),
 the IdP generates a special ``identity proof'' to bind the user's unique identifier (i.e., email address) to a public key.
With the corresponding private key, the user signs an extra subsidiary identity proof to bind the visited RP's identity and its identity, %(including the user certificate),
and sends this pair of identity proofs to that RP.
In this way, the IdP does not know the RP's identity when generating identify proofs.
SPRESSO requires the RP to create a one-time pseudo-identifier at each login for the IdP to generate an identity proof,
    and then hides the RP's real identity from the IdP.
The RP employs a third-party entity called forwarder, which works as a proxy to relay the identity proof from the IdP to the corresponding RP.
In both schemes, the RPs' identities are protected from the IdP;
 however, the IdP has to know the user's unique identifier (e.g., email address) and includes it in identity proofs
  so that the visit RP can recognize the user in her multiple logins.
  As a result, both schemes are still vulnerable to RP-based identity linkage.

As discussed above, none of the existing SSO systems defend against both IdP-based login tracing and RP-based identity linkage at the same time.
Before presenting our solution, we first formally analyze the privacy problems and solutions.
Let us denote the user's and the visited RP's identities as $ID_U$ and $ID_{RP}$, respectively.
 %, where $ID_U$ is known to the user and IdP and $ID_{RP}$ is known to the user and RP.
To protect user privacy against RP-based identity linkage, $ID_U$ should not be explicitly included in the identity proof which will be received by the RP. Instead, a privacy-preserving pseudo-identifier $PID_{U}$ should be used (as in the PPID-based approaches~\cite{OpenIDConnect, SAMLIdentifier}), which can be viewed as the output of a one-way identifier-transformation function $\mathcal{F}_{ID_{U} \mapsto PID_{U}}$ at the IdP,
    which authenticates the user and then knows $ID_U$.
Similarly, to prevent IdP-based login tracing,
 $ID_{RP}$ should not be explicitly included in the identity proof but be replaced by a pseudo-identifier $PID_{RP}$ (as in SPRESSO~\cite{SPRESSO} and BrowserID~\cite{BrowserID}), which is obtained by another one-way function $\mathcal{F}_{ID_{RP} \mapsto PID_{RP}}$ at the RP.
However, if both $PID_{U}$ and $PID_{RP}$ are used in identity proofs to replace $ID_U$ and $ID_{RP}$ at the same time, assuming they can be securely exchanged between the IdP and the RP in an SSO login process,
 the RP will allow the user to log in as $PID_U$, which will be different in the user's multiple logins at a same RP;
    otherwise, the IdP might be able to associate these RPs visited by the user.
As a result, the RP has no clues to derive the user account at the RP but has to treat her as a one-time user every time when she logs in.
This violates the basic requirements of SSO services.

In this paper, we propose an Unlinkable Privacy-PREserving Single Sign-On (UPPRESSO) system to provide comprehensive protections
 against both IdP-based login tracing and RP-based identity linkage.
The key idea of UPPRESSO is to design a special identifier-transformation function $\mathcal{F}_{PID_{U} \mapsto Account}$, which maps {\em all} $PID_U$s of a user to \emph{one} unique $Account$  in all logins to an RP, where $Account$ is created when the user logs into the RP for the first time.
Since in every login instance $PID_U$ and $PID_{RP}$ are separately generated by the IdP and the RP, respectively,
 we have to design associative one-way identifier-transformation functions $\mathcal{F}_{ID_{U} \mapsto PID_{U}}$ and $\mathcal{F}_{ID_{RP} \mapsto PID_{RP}}$,
  so that three identifier-transformation functions work cooperatively to ensure: (\emph{a}) when a user logs into an RP for multiple times, the RP always maps $PID_U$s to an identical $Account$ without knowing the user's identity;
   moreover,
  when a user logs into multiple RPs,
   (\emph{a}) a curious IdP cannot link multiple $PID_{RP}$s to a particular RP or associate them together,
    and collusive RPs (\emph{c}) cannot link $PID_U$s to a particular user or associate them together, (\emph{d}) nor link $Account$s of a same user at different RPs.

To completely achieve these goals, we design three one-way identifier-transformation functions based on the discrete logarithm problem.
We design a one-way trapdoor function $\mathcal{F}_{ID_{RP} \mapsto PID_{RP}}(ID_{RP}, T)$ for an RP to generate a random $PID_{RP}$ based on a randomly generated trapdoor $T$, and a one-way function  $\mathcal{F}_{ID_{U} \mapsto PID_{U}}(ID_U, PID_{RP})$ for the IdP to generate $PID_U$ based on $PID_{RP}$.
With the trapdoor $T$, the RP applies $\mathcal{F}_{PID_{U} \mapsto Account}(PID_U, PID_{RP}, T)$
        to identity proofs binding $PID_{RP}$ and $PID_U$,
 to derive the unique $Account$. We summarize our contributions as follows.
%我们的贡献
%提出协议
%考虑能否根据模型进行分析
%实现原型系统
%The main contributions of UPPRESSO are as follows:
\begin{itemize}
\item We formally analyze the privacy problems in SSO as an identifier-transformation problem,
    and propose the first comprehensive solution to hide the users' login traces from both the curious IdP and malicious collusive RPs.
To the best of our knowledge, UPPRESSO is the first SSO system that provides secure SSO services against IdP-based login tracing and RP-based identity linkage.
\item We systematically analyze  the security of UPPRESSO and show that it achieves the same security level as existing SSO systems,
    while the users' login traces are well protected.
\item We have implemented a prototype of UPPRESSO based on an open-source implementation of OIDC, which requires only small modifications to support three identifier-transformation functions for privacy protections.
    Unlike  BrowserID and SPRESSO, UPPRESSO does not require non-trivial re-designs of SSO services, which makes it more compatible with existing SSO systems.
\item We compare the performance of the UPPRESSO prototype with the state-of-the-art SSO systems (i.e., OIDC and SPRESSO), and demonstrate its efficiency.
\end{itemize}

%文章结构
The rest of the paper is organized as follows. We first introduce the background and preliminaries in Section~\ref{sec:background}. Then, we describe the identifier-transformation based approach, the threat model, and our UPPRESSO design in Sections~\ref{sec:challenge}, \ref{sec:assumptionandthreatmodel} and \ref{sec:UPPRESSO}, followed by a systematical analysis of security and privacy in Section~\ref{sec:analysis}. We provide the implementation specifics and experiment evaluation in Section~\ref{sec:implementation}, discuss the related works in Section~\ref{sec:related}, and conclude our work in Section~\ref{sec:conclusion}.
